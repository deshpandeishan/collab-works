<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CollabWorks - Freelancer Register</title>
    <link rel="icon" href="{{ url_for('static', filename='/img/logo/collabworks.ico') }}" type="image/x-icon">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auth/register/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
</head>
<style>
    #freelancer_step3 {
        align-items: center;
        gap: 20px;
        padding: 20px;
    }

    .name-container {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        width: 100%;
    }

    #freelancer_first_name,
    #freelancer_last_name {
        flex: none;
        max-width: 85%;
        margin: 10px auto;
    }

    #fn_label {
        top: 15%;
    }

    #sn_label {
        animation: none;
        top: 65%;
    }

    #plus-icon {
        color: #5c5c5c;
        margin-right: 5px;
        font-size: 14px;
        font-weight: 600;
    }

    #freelancer_step4 {
        flex-direction: row;
        align-items: center;
        gap: 20px;
        padding: 20px;
    }

    #roles-section {
        width: 100%;
        display: flex;
        flex-direction: row;
        justify-content: center;
        padding: 10px;
        border-radius: 5px;
        margin: 0 auto;
    }

    #roles-tag-line {
        text-align: center;
        font-size: 20px;
        color: #5c5c5c;
        text-align: center;
        font-weight: 600;
        margin-bottom: 10px;
        max-width: fit-content;
    }

    #roles-section ul {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 0;
        list-style: none;
        min-width: 900px;
        justify-content: center;
        align-items: center;
        margin: 50px auto;
    }

    #roles-section ul li {
        background: #f5f5f5;
        padding: 8px 16px;
        border-radius: 8px;
        color: #5c5c5c;
        font-size: 14px;
        font-weight: 600;
        white-space: nowrap;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #roles-section ul li:hover {
        background: #eeeeee;
        cursor: pointer;
        user-select: none;
    }

    #roles-section ul li.selected {
        background: #28a745;
        color: white;
    }

    #roles-section ul li.selected i {
        color: white;
    }


    .step { 
        display: none;
    }
</style>
<body>
    <div class="container fade-in">
        <div class="register-section">
            <div class="logo-container">
                <a href="{{ url_for('index') }}">
                    <img src="{{ url_for('static', filename='/img/logo/icon-logo.png') }}" alt="CollabWorks logo">
                </a>
            </div>

            <div class="freelancer-registration">
                <form id="freelancer_registrationForm" method="POST" action="{{ url_for('freelancer.freelancer_register') }}">
                    {{ form.hidden_tag() }}
                    
                    <div class="step active" id="freelancer_step1">

                        <h4>Join as Freelancer!</h4>
                        <p>Showcase your talent to clients</p>
                        <div class="form-group input-group">
                            {{ form.username(class="input", id="freelancer_username", required="required", autocomplete="off") }}
                            <label for="freelancer_username" class="label">Username</label>
                            <div id="freelancer_username_warning" class="warning-message"></div>
                        </div>
                        <button type="button" class="btn btn-primary next-button" id="freelancer_nextButton" disabled onclick="freelancerNextStep(2)">Next</button>
                    </div>

                    <div class="step" id="freelancer_step2">
                        <p>Enter Email and create password</p>

                        <div class="form-group input-group">
                            {{ form.email(class="input", id="freelancer_email", required="required", autocomplete="off") }}
                            <label for="freelancer_email" class="label">Email</label>
                            <small id="freelancer_emailMessage" class="form-text text-danger" style="display:none;"></small>
                        </div>                    

                        <div class="form-group input-group">
                            {{ form.password(class="input", id="freelancer_password", required="required", autocomplete="off") }}
                            <label for="freelancer_password" class="label">Password</label>
                            <span class="password-toggle" onclick="freelancerTogglePasswordVisibility()">
                                <i id="freelancer_toggleIcon" class="fas fa-eye"></i>
                            </span>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="freelancer_termsCheck" required>
                            <label class="form-check-label" for="freelancer_termsCheck">
                                I agree to the <a href="{{ url_for('terms_of_service') }}">Terms of Service</a> and <a href="{{ url_for('privacy_policy') }}">Privacy Policy</a>.
                            </label>
                        </div>
                        <div class="button-container">
                            <button type="button" class="btn btn-primary" onclick="freelancerPrevStep(1)">Back</button>
                            <button type="button" class="btn btn-primary next-button" onclick="freelancerNextStep(3)" id="freelancer_nextButton2" disabled>Next</button>
                        </div>
                    </div>

                    <div class="step" id="freelancer_step3">
                        <div class="name-container" id="#name-container">
                            <div class="form-group input-group">
                                {{ form.first_name(class="input", id="freelancer_first_name", required="required", autocomplete="off") }}
                                <label id="fn_label" for="freelancer_first_name" class="label">First name</label>
    
                                {{ form.last_name(class="input", id="freelancer_last_name", required="required", autocomplete="off") }}
                                <label id="sn_label" for="freelancer_last_name" class="label">Last Name</label>
                            </div>
                        </div>
                        
                        <div class="submit-container">
                            <button type="button" class="btn btn-primary" onclick="freelancerNextStep(4)">Next</button>
                        </div>
                          
                    </div>

                    <div class="step" id="freelancer_step4">
                        <p id="roles-tag-line">Select a role to showcase your expertise</p>
                        
                        <div class="roles-section" id="roles-section">
                            <ul>
                                <li> <i id="plus-icon" class="fa-solid fa-plus"></i>Frontend Developer</li>
                                <li> <i id="plus-icon" class="fa-solid fa-plus"></i>Backend Developer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>Machine Learning Engineer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>UI/UX Designer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>Mobile App Developer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>Data Engineer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>Game Developer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>DevOps Engineer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>Cybersecurity Specialist</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>Cloud Engineer</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>Database Administrator</li>
                                <li><i id="plus-icon" class="fa-solid fa-plus"></i>QA Tester</li>
                            </ul>
                        </div>
                        <div class="submit-container">
                            {{ form.submit(class="btn btn-primary") }}
                        </div>
                    </div>
                    <input type="hidden" name="roles" id="selectedRoles">

                </form>

                <div class="register-link">
                    <p>Already have an account? <a href="{{ url_for('freelancer.freelancer_login') }}">Log In</a></p>
                </div>

                <div class="looking-for-talent">
                    <p>Looking for talent? <a href="{{ url_for('client.client_register') }}">Join as a employer</a></p>
                </div>

            </div>
        </div>
    </div>

    <script>
        document.getElementById('freelancer_first_name').addEventListener('focus', function() {
            document.querySelector('label[for="freelancer_first_name"]').textContent = 'Name';
        });

        document.getElementById('freelancer_first_name').addEventListener('blur', function() {
            document.querySelector('label[for="freelancer_first_name"]').textContent = 'First Name';
        });

        function freelancerNextStep(step) {
            const currentStep = document.querySelector('.step.active');
            const nextStep = document.getElementById('freelancer_step' + step);
            if (freelancerValidateStep(currentStep)) {
                currentStep.classList.remove('active');
                nextStep.classList.add('active');
            }
        }

        function freelancerPrevStep(step) {
            const currentStep = document.querySelector('.step.active');
            const prevStep = document.getElementById('freelancer_step' + step);
            currentStep.classList.remove('active');
            prevStep.classList.add('active');
        }

        function freelancerValidateStep(stepElement) {
            const inputs = stepElement.querySelectorAll('input');
            for (let input of inputs) {
                if (!input.checkValidity()) {
                    input.reportValidity();
                    return false;
                }
            }
            return true;
        }



        const freelancerUsernameInput = document.getElementById('freelancer_username');
        const freelancerNextButton = document.getElementById('freelancer_nextButton');
        const freelancerWarning = document.getElementById('freelancer_username_warning');
        let freelancerDebounceTimeout;

        freelancerUsernameInput.addEventListener('input', function () {
            this.value = this.value.toLowerCase();
        });

        freelancerUsernameInput.addEventListener('input', function () {
            const username = this.value.trim();
            clearTimeout(freelancerDebounceTimeout);

            freelancerDebounceTimeout = setTimeout(() => {
                if (username.length > 3) {
                    fetch(`/freelancer/check_username?username=${encodeURIComponent(username)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (!data.available) {
                                freelancerWarning.textContent = 'That username is already taken. Please choose a different one.';
                                freelancerWarning.style.display = 'block';
                                freelancerNextButton.disabled = true;
                            } else {
                                freelancerWarning.style.display = 'none';
                                freelancerNextButton.disabled = false;
                            }
                        })
                        .catch(() => {
                            freelancerWarning.textContent = 'Error checking username.';
                            freelancerWarning.style.display = 'block';
                            freelancerNextButton.disabled = true;
                        });
                } else {
                    freelancerWarning.textContent = 'Username must be at least 4 characters long.';
                    freelancerWarning.style.display = 'block';
                    freelancerNextButton.disabled = true;
                }
            }, 500);
        });

        const freelancerEmailInput = document.getElementById('freelancer_email');
        const freelancerEmailMessage = document.getElementById('freelancer_emailMessage');
        const freelancerNextButton2 = document.getElementById('freelancer_nextButton2');
        let freelancerDebounceTimeoutEmail;
        let freelancerEmailValid = false;

        freelancerEmailInput.addEventListener('input', function () {
            this.value = this.value.toLowerCase();
            const email = this.value.trim();
            clearTimeout(freelancerDebounceTimeoutEmail);

            freelancerDebounceTimeoutEmail = setTimeout(() => {
                if (!freelancerValidateEmail(email)) {
                    freelancerEmailMessage.textContent = "Please enter a valid email address.";
                    freelancerEmailMessage.style.display = "block";
                    freelancerEmailValid = false;
                } else {
                    fetch(`/freelancer/check_email?email=${encodeURIComponent(email)}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.exists) {
                                freelancerEmailMessage.textContent = "This email is already in use. Please choose a different one.";
                                freelancerEmailMessage.style.display = "block";
                                freelancerEmailValid = false;
                            } else {
                                freelancerEmailMessage.textContent = "";
                                freelancerEmailMessage.style.display = "none";
                                freelancerEmailValid = true;
                            }
                            freelancerToggleNextButton();
                        })
                        .catch(() => {
                            freelancerEmailMessage.textContent = "Error checking email.";
                            freelancerEmailMessage.style.display = "block";
                            freelancerEmailValid = false;
                            freelancerToggleNextButton();
                        });
                }
            }, 500);
        });


        function freelancerToggleNextButton() {
            freelancerNextButton2.disabled = !freelancerEmailValid;
        }

        function freelancerValidateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function freelancerTogglePasswordVisibility() {
            const passwordInput = document.getElementById('freelancer_password');
            const toggleIcon = document.getElementById('freelancer_toggleIcon');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        const selectedRolesInput = document.getElementById('selectedRoles');

        function updateSelectedRoles() {
            const selectedRoles = Array.from(document.querySelectorAll('#roles-section ul li.selected'))
                .map(li => li.textContent.trim());
            selectedRolesInput.value = selectedRoles.join(', ');
        }

        document.querySelectorAll('#roles-section ul li').forEach(item => {
            item.addEventListener('click', () => {
                const icon = item.querySelector('i');
                item.classList.toggle('selected');
                icon.classList.toggle('fa-plus');
                icon.classList.toggle('fa-check');
                updateSelectedRoles();
            });
        });

    </script>
</body>
</html>
